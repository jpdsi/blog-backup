---
title: IIS の調査に必要な FTP の情報について
date: 2020-01-28
tags: 
  - Internet Information Services
  - ログ採取
---

こんにちは。
 
IIS サポート チームです！

以前、以下の Blog 記事において 4 つの基本的なログ情報について執筆しています。

　IIS の調査に必要な基本的なログ情報について
　https://github.com/jpdsi/blog/blob/master/articles/web-apps/LogCollection1.md

しかし、問題が FTP に関係する場合には、実は上記とは異なる以下のログの採取が必要となります。

1. **アクセス権情報**
2. **イベント ログ**
3. **FTP アクセス ログ**
4. **IIS 構成情報**

FTP に関係する現象というのは、例えば 550 エラーが発生する場合や、または
これまで実現できていた FTP コマンドが期待通りに動作しない等です。

また、ログをご提供いただきましたら、まずは現象発生時刻周辺を確認するため、
ログのご提供と同時に、以下を併せてお知らせいただけますと嬉しいです！

- **現象発生時刻（時分秒）**
- **現象が発生したディレクトリのパス**

---------------
## 1. アクセス権情報
アクセス権情報とは、現象が発生していたディレクトリのアクセス権の情報を確認するため、各ディレクトリに対して管理者権限で下記のコマンドを実行した結果 (出力されたテキスト ファイル) となります。

  >icacls /T (対象のディレクトリのフルパス) > (実行結果を出力するファイルのフルパス)
   
例) 対象のディレクトリが c:\inetpub\ftproot\sub、実行結果を出力するファイルのフルパスを c:\temp\icaclsNG.txt とする場合

  >icacls /T c:\inetpub\ftproot\sub > c:\temp\icaclsNG.txt

## 2. イベント ログ
1. Windows Server 上にてイベント ビューアーを起動します（コマンド: eventvwr）
2. [Windows ログ] を展開します
3. 以下をそれぞれ右クリックし、[すべてのイベントを名前をつけて保存] を選択します    
 
- Application（アプリケーション）
- システム
- セキュリティ

## 3. FTP アクセス ログ
FTP アクセス ログは既定で %SystemDrive%\inetpub\logs\LogFiles\FTPSVCn (n はサイト識別子) フォルダーに u_exYYMMDD.log として保存されます。

調査には、現象が発生した日時および復旧した日時のログを含む FTP アクセスログが必要となります。
なお、ログは UTC 時間で記録されますので、日本時間から -9 時間ずれて記録されます。

## 4. IIS 構成情報
IIS の構成情報は %SystemRoot%\system32\inetsrv\config\applicationHost.config となります。


今回は以上です。 それでは、また次回！

---
なお、本ブログは弊社の公式見解ではなく、予告なく変更される場合があります。 もし公式な見解が必要な場合は、弊社ドキュメント (https://docs.microsoft.com/ や https://support.microsoft.com) をご参照いただく、もしくは私共サポートまでお問い合わせください。