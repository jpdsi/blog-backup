---
title: 異なるドメイン間で仮想ディレクトリを作成する場合の注意点
date: 2021-04-19
tags: 
  - Internet Information Services
  - Virtual Directory
---

こんにちは。IIS サポート チームです。

IIS 上で仮想ディレクトリを作成することがありますが、信頼関係がない異なるドメイン間で仮想ディレクトリを作成しようとした場合、仮想ディレクトリの作成に失敗します。具体的には仮想ディレクトリを作成する際に別ドメインの資格情報を記入するタイミングでエラーが発生します。

 ![IIS仮想ディレクトリ図](/articles/web-apps/VirtualDirectory/pic.png)

この現象の再現方法は以下の通りになります。

1. ドメインAに参加しているマシン上にあるIISマネージャーを起動します。
2. サイト用の仮想ディレクトリを追加します。
3. 「接続」方法として「特定ユーザー」を選択し、資格情報の設定を行います。
4. 「資格情報の設定」画面に信頼関係を結んでいないドメイン Bのユーザー名とパスワードを入力します。
5. 「資格情報の設定」画面のOKボタンを実行すると、「指定したパスワードは無効です。新しいパスワードを入力してください。」とエラーが表示されます。

資格情報を記入した後、設定を完了するタイミングで行われる IIS の内部処理で、指定したユーザー情報を利用して認証を試みます。「資格情報の設定」画面に入力したドメイン名、ユーザー名、パスワードをもとに認証を試みますが、信頼関係のないドメインのユーザーの資格情報ではログインできないため、認証に失敗し、該当のエラーが記録されます。

この挙動は IIS の想定された動作になります。そのため、異なるドメイン間で仮想ディレクトリを作成いただく場合は、事前にドメイン間で信頼関係を築いていただく必要があります。
